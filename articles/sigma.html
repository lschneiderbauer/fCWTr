<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Controlling the wavelet spread • fCWTr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Controlling the wavelet spread">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fCWTr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/sigma.html">Controlling the wavelet spread</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lschneiderbauer/fCWTr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Controlling the wavelet spread</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lschneiderbauer/fCWTr/blob/master/vignettes/sigma.Rmd" class="external-link"><code>vignettes/sigma.Rmd</code></a></small>
      <div class="d-none name"><code>sigma.Rmd</code></div>
    </div>

    
    
<p>The continuous wavelet transform (CWT) essentially evaluates a
correlation function of the input signal with shifted and scaled Morlet
wavelets. A Morlet wavelet is a sinusoidal wave packet modulated by a
Gaussian envelope. The spread of Gaussian envelope is what controls the
time/frequency balance of the FCWT result.</p>
<p>In contrast to the <a href="https://en.wikipedia.org/wiki/Short-time_Fourier_transform" class="external-link">Short
Time Fourier Transform</a>, where the window size does not depend on the
frequency, the CWT models a frequency-dependent window size by the
frequency depending spread of the Gaussian envelope.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;That is of course one of the selling points of the CWT:
it works for all frequency ranges, while the fixed window size in the
Short Time Fourier Transform will break down when probing modes whose
wavelength approach the window size, at the same time it lacks a
reasonable time resolutions for modes whose wavelength is much smaller
than the window size.&lt;/p&gt;"><sup>1</sup></a></p>
<p>For a particular time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and a reference frequency
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>,
the Gaussian envelope
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>f</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(t, f)</annotation></semantics></math>
of the wavelet is given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>f</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>∼</mo><msup><mi>e</mi><mrow><mo>−</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>t</mi><mi>f</mi></mrow><mrow><mn>2</mn><mi>σ</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></msup></mrow><annotation encoding="application/x-tex">g(t, f) \sim e^{-\left( \frac{t f}{2 \sigma} \right)^2}</annotation></semantics></math>
with variance in time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>t</mi><mo>=</mo><mfrac><mi>σ</mi><mi>f</mi></mfrac></mrow><annotation encoding="application/x-tex">\Delta t=\frac{\sigma}{f}</annotation></semantics></math>
which also sets the scale for the effective time resolution of the CWT
at frequency
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>.
The corresponding frequency resolution is given by the spreading of the
Gaussian envelope in Fourier space:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>f</mi><mo>=</mo><mfrac><mi>f</mi><mrow><mn>2</mn><mi>π</mi><mi>σ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\Delta f = \frac{f}{2\pi \sigma}</annotation></semantics></math>.
The time and frequency resolution satisfy the famous time-frequency
uncertainty relation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>t</mi><mi>Δ</mi><mi>f</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>π</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\Delta t \Delta f=\frac{1}{2\pi}</annotation></semantics></math>.</p>
<p>The time-frequency uncertainty relation is always true, but we can
adjust the parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
to increase (decrease) time resolution at the cost of decreasing
(increasing) the frequency resolution. The “correct” balance depends on
your use case.</p>
<div class="section level3">
<h3 id="example-piano-keys">Example: Piano keys<a class="anchor" aria-label="anchor" href="#example-piano-keys"></a>
</h3>
<p>Let’s try to understand the meaning of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
via an example: We would like to analyse piano music, and be able to at
least distinguish different piano key frequencies.</p>
<p>We can for example check what the resolutions corresponding to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sigma=1</annotation></semantics></math>
at the key A4 (440 Hz) is with helper functions that implement the
formulas above:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lschneiderbauer.github.io/fCWTr/" class="external-link">fCWTr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sigma_resolution.html">sigma_resolution</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">1</span>, <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">440</span>, <span class="st">"Hz"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $time</span></span>
<span><span class="co">#&gt; 0.002272727 [1/Hz]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $freq</span></span>
<span><span class="co">#&gt; 70.02817 [Hz]</span></span></code></pre></div>
<p>We see now, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sigma=1</annotation></semantics></math>,
our frequency resolution at 440 Hz is only 70 Hz! The spreading is way
too high to be able to distinguish different keys (the next key A#4 is
at 466 Hz and the previous key Ab4 is at 415 Hz), we need to able at
least to resolve the difference, 15 Hz. Let’s be sure and make it half
of that, 7 Hz. We can use another helper function to check what the
corresponding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
should be:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sigma_from_frequency_resolution.html">sigma_from_frequency_resolution</a></span><span class="op">(</span><span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">7</span>, <span class="st">"Hz"</span><span class="op">)</span>, <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">440</span>, <span class="st">"Hz"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10.00402</span></span></code></pre></div>
<p>and it tells us we need
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\sigma=10</annotation></semantics></math>
or higher. Let’s double-check what that implies for the time
resolution:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sigma_resolution.html">sigma_resolution</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">10</span>, <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">440</span>, <span class="st">"Hz"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $time</span></span>
<span><span class="co">#&gt; 0.02272727 [1/Hz]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $freq</span></span>
<span><span class="co">#&gt; 7.002817 [Hz]</span></span></code></pre></div>
<p>That means, we can detect those frequencies with a time resolution of
22 milliseconds. A typical very fast piano beat is around 180 beats per
minutes (&gt; Prestissimo), that means, 3 beats per seconds, and the
required time resolution to detect that is at least 330 milliseconds: we
have no problems doing that with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\sigma =10</annotation></semantics></math>,
and even have some leeway.</p>
<p>Let’s compare these two settings in practice:</p>
<div class="section level4">
<h4 id="sigma-1">Sigma = 1<a class="anchor" aria-label="anchor" href="#sigma-1"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span>
<span></span>
<span><span class="fu"><a href="../reference/fcwt_batch.html">fcwt_batch</a></span><span class="op">(</span></span>
<span>  <span class="va">ts_piano_sample</span>,</span>
<span>  sample_freq <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">44.1</span>, <span class="st">"kHz"</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span>,</span>
<span>  freq_begin <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">220</span>, <span class="st">"Hz"</span><span class="op">)</span>,</span>
<span>  freq_end <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">440</span>, <span class="st">"Hz"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4</span>,</span>
<span>  <span class="co"># 5 octaves, 12 keys per octave, 3 frequencies per key</span></span>
<span>  n_freqs <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">3</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  freq_scale <span class="op">=</span> <span class="st">"log"</span>,</span>
<span>  time_resolution <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"ms"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sigma_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="sigma-10">Sigma = 10<a class="anchor" aria-label="anchor" href="#sigma-10"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/fcwt_batch.html">fcwt_batch</a></span><span class="op">(</span></span>
<span>  <span class="va">ts_piano_sample</span>,</span>
<span>  sample_freq <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">44.1</span>, <span class="st">"kHz"</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span>,</span>
<span>  freq_begin <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">220</span>, <span class="st">"Hz"</span><span class="op">)</span>,</span>
<span>  freq_end <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">440</span>, <span class="st">"Hz"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4</span>,</span>
<span>  <span class="co"># 5 octaves, 12 keys per octave, 3 frequencies per key</span></span>
<span>  n_freqs <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">3</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  freq_scale <span class="op">=</span> <span class="st">"log"</span>,</span>
<span>  time_resolution <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"ms"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sigma_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="sigma-20">Sigma = 20<a class="anchor" aria-label="anchor" href="#sigma-20"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fcwt_batch.html">fcwt_batch</a></span><span class="op">(</span></span>
<span>  <span class="va">ts_piano_sample</span>,</span>
<span>  sample_freq <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">44.1</span>, <span class="st">"kHz"</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span>,</span>
<span>  freq_begin <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">220</span>, <span class="st">"Hz"</span><span class="op">)</span>,</span>
<span>  freq_end <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">440</span>, <span class="st">"Hz"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4</span>,</span>
<span>  <span class="co"># 5 octaves, 12 keys per octave, 3 frequencies per key</span></span>
<span>  n_freqs <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">3</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  freq_scale <span class="op">=</span> <span class="st">"log"</span>,</span>
<span>  time_resolution <span class="op">=</span> <span class="fu"><a href="../reference/u.html">u</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"ms"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sigma_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>In some way,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
can be thought of the exposure time of a camera that has to adjusted
manually. Is the exposure time too long the picture becomes blurry, is
it too short, the picture becomes too dark to see anything. A good
balance is the key to a good picture.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lukas Schneiderbauer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
