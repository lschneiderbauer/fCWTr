<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fast continuous wavelet transform - Batch processing — fcwt_batch • fCWTr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fast continuous wavelet transform - Batch processing — fcwt_batch"><meta name="description" content="Performs a fast continuous wavelet transform on long sequences by sequentially
processing junks of the input signal and keeping only low-resolution output
data by averaging to preserve memory.
This is only useful for very long signals whose output does not fit into
the available memory as a whole.
It should not be used on short signals since boundary artefacts are
automatically discarded (and those potentially dominate for short signals)."><meta property="og:description" content="Performs a fast continuous wavelet transform on long sequences by sequentially
processing junks of the input signal and keeping only low-resolution output
data by averaging to preserve memory.
This is only useful for very long signals whose output does not fit into
the available memory as a whole.
It should not be used on short signals since boundary artefacts are
automatically discarded (and those potentially dominate for short signals)."><meta property="og:image" content="https://lschneiderbauer.github.io/fcwtr/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fCWTr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/sigma.html">Controlling the time/frequency resolution</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lschneiderbauer/fCWTr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Fast continuous wavelet transform - Batch processing</h1>
      <small class="dont-index">Source: <a href="https://github.com/lschneiderbauer/fCWTr/blob/master/R/fcwt_batch.R" class="external-link"><code>R/fcwt_batch.R</code></a></small>
      <div class="d-none name"><code>fcwt_batch.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs a fast continuous wavelet transform on long sequences by sequentially
processing junks of the input signal and keeping only low-resolution output
data by averaging to preserve memory.
This is only useful for very long signals whose output does not fit into
the available memory as a whole.
It should not be used on short signals since boundary artefacts are
automatically discarded (and those potentially dominate for short signals).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fcwt_batch</span><span class="op">(</span></span>
<span>  <span class="va">signal</span>,</span>
<span>  <span class="va">sample_freq</span>,</span>
<span>  <span class="va">n_freqs</span>,</span>
<span>  freq_begin <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">sample_freq</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">signal</span><span class="op">)</span>,</span>
<span>  freq_end <span class="op">=</span> <span class="va">sample_freq</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>  freq_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"linear"</span>, <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">time_resolution</span>,</span>
<span>  max_batch_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">/</span><span class="op">(</span><span class="va">n_freqs</span> <span class="op">*</span> <span class="fl">8</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  n_threads <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  progress_bar <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-signal">signal<a class="anchor" aria-label="anchor" href="#arg-signal"></a></dt>
<dd><p>Real-valued time series. The time steps are assumed to be evenly spaced.</p></dd>


<dt id="arg-sample-freq">sample_freq<a class="anchor" aria-label="anchor" href="#arg-sample-freq"></a></dt>
<dd><p>Sampling rate of input time series. This number primarily establishes
a connection to physical units which is used in other frequency definitions
as well as the units of the output data. Expects either a value with frequency
units, generated with <code><a href="u.html">u()</a></code>, or a pure number, in which case it is
interpreted in units of 'Hertz'.</p></dd>


<dt id="arg-n-freqs">n_freqs<a class="anchor" aria-label="anchor" href="#arg-n-freqs"></a></dt>
<dd><p>Number of frequency bins generated by the CWT. The frequencies
are linearly or logarithmically distributed, depending on the <code>freq_scale</code>
argument. Computation time increases when raising the
number of frequency bins.</p></dd>


<dt id="arg-freq-begin-freq-end">freq_begin, freq_end<a class="anchor" aria-label="anchor" href="#arg-freq-begin-freq-end"></a></dt>
<dd><p>Optionally specifies the frequency range <code>[freq_end, freq_begin]</code>. If not
specified the maximal meaningful frequency range, depending on the input signal,
is taken.
A frequency-valued number, generated with <code><a href="u.html">u()</a></code>, or a pure number, that is
interpreted in units of 'Hertz'.</p></dd>


<dt id="arg-freq-scale">freq_scale<a class="anchor" aria-label="anchor" href="#arg-freq-scale"></a></dt>
<dd><p>( <code>"freq"</code> | <code>"log"</code> )
Should the frequency scale be linear or logarithmic?
"linear"  / "log" for linear / logarithmic.</p></dd>


<dt id="arg-sigma">sigma<a class="anchor" aria-label="anchor" href="#arg-sigma"></a></dt>
<dd><p>Sets a dimensionless parameter \(\Sigma\) controlling the wavelet spread.
Changing this parameter adjusts the time/frequency uncertainty balance,
\(\Delta t = 4 \frac{\Sigma}{f}\), \(\Delta f = 4 \frac{f}{2\pi \Sigma}\).
Larger (lower) value of sigma corresponds to a better (worse) frequency
resolution and a worse (better) time resolution.</p>
<p>For more information, see <code><a href="../articles/sigma.html">vignette("sigma", package = "fCWTr")</a></code>).</p>
<p>Defaults to \(2\pi\). Note that there is not really a natural choice for
sigma, it depends on the use case. So the default choice can very well be
quite a bad choice (it probably is for audio data).</p></dd>


<dt id="arg-time-resolution">time_resolution<a class="anchor" aria-label="anchor" href="#arg-time-resolution"></a></dt>
<dd><p>The time resolution of the output signal in physical units (by <code><a href="u.html">u()</a></code>),
or a pure number, which is interpreted in unit of seconds.
The time resolution of the high-resolution result will be reduced to
<code>time_resolution</code> by averaging fixed time slice windows.
Memory consumption is directly related to that.
<code>time_resolution</code> cannot be higher than the time resolution
of the input signal.</p></dd>


<dt id="arg-max-batch-size">max_batch_size<a class="anchor" aria-label="anchor" href="#arg-max-batch-size"></a></dt>
<dd><p>The maximal batch size that is used for splitting up the input sequence.
This limits the maximal memory that is used. Defaults to roughly 1GB, being
conservative and taking into account that R might make copies when further
processing it.
The actual batch size is the largest batch size that is smaller than
<code>max_batch_size</code> and compatible with the requested <code>time_resolution</code>.
You should aim to set the batch size as large as possible given your
memory constraints (boundary effects become larger the smaller the
batch size).</p></dd>


<dt id="arg-n-threads">n_threads<a class="anchor" aria-label="anchor" href="#arg-n-threads"></a></dt>
<dd><p>Number of threads used by the computation, if supported by your platform.
Defaults to 2 threads (to accommodate CRAN requirements).
If <code><a href="openmp_enabled.html">openmp_enabled()</a></code> returns <code>FALSE</code>, this argument is ignored, and
only a single thread is used.</p></dd>


<dt id="arg-progress-bar">progress_bar<a class="anchor" aria-label="anchor" href="#arg-progress-bar"></a></dt>
<dd><p>Monitoring progress can sometimes be useful when performing time consuming
operations. Setting <code>progress_bar = TRUE</code> enables printing a progress
bar to the console, printing the "loss ratio" and the number of batches.
The loss ratio is a number
between 0 and 1 and indicates how much of the batch computation has to be
thrown away due to boundary artefacts. The higher the batch size the smaller
the loss ratio will be.
Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The spectogram, a numeric real-valued matrix with dimensions roughly
<code>dim ~ c(length(signal) * time_resolution * sample_freq, n_freqs)</code>.
The exact length of the output depends on boundary effect details.
This matrix is wrapped into a S3-class "fcwtr_scalogram" so that plotting and
coercion functions can be used conveniently.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In case of input sequences that exceed the a certain size, the output
sequence will not fit into the local memory and the fcwt cannot be
performed in one run.
For instance, in case of processing a song of 10 minutes length (assuming
a sampling rate of 44100 Hz), the size of the output vector is
<code>10 * 60 seconds * 44100 Hz * nfreqs * 8 bytes</code>,
which for e.g. <code>nfreqs = 200</code>, equals ~ 42 GB, hence
nowadays already at the limit of the hardware of a modern personal computer.</p>
<p>In cases where the required output time-resolution is smaller than the time
resolution of the input signal, one can perform the <code><a href="fcwt.html">fcwt()</a></code> and reduce the
output size by averaging.
(The input signal time resolution can in general not be reduced since
high-frequency information would get lost.)</p>
<p>This function splits up the input sequence into batches, processes each
batch separately, reduces the time resolution, and adds the outputs together.</p>
<p>Attention: In contrast to <code><a href="fcwt.html">fcwt()</a></code> boundary artefacts are automatically removed,
so some information at the beginning and the end of the
sequence is lost. (The amount depends on the minimal frequency captured <code>min_freq</code>.)</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="fcwt.html">fcwt()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu">fcwt_batch</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">ts_sin_sin</span>,</span></span>
<span class="r-in"><span>  sample_freq <span class="op">=</span> <span class="fl">44100</span>,</span></span>
<span class="r-in"><span>  freq_begin <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  freq_end <span class="op">=</span> <span class="fl">11000</span>,</span></span>
<span class="r-in"><span>  n_freqs <span class="op">=</span> <span class="fl">30</span>,</span></span>
<span class="r-in"><span>  sigma <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  time_resolution <span class="op">=</span> <span class="fl">0.01</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _Scalogram_</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;&gt; (Time/Frequency) dimension: [60,30]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;&gt; Sampling rate: 100 [Hz]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;&gt; Frequency scale: 100 [Hz] - 11000 [Hz], linear</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;&gt; Time offset: 0.2 [s] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;&gt; Sigma: 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time/frequency matrix summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.0000000 0.0000041 0.0000116 0.0256150 0.0000365 0.9354089 </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lukas Schneiderbauer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

